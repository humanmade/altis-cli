#!/usr/bin/env node
"use strict";
const loudRejection = require('loud-rejection');
const pkg = require('../package.json');
const updateNotifier = require('update-notifier');
const yargs = require( 'yargs' );

const csCommand = require( '../lib/commands/cs' );
const githubCommand = require( '../lib/commands/github' );
const issuesCommand = require( '../lib/commands/issues' );
const prsCommand = require( '../lib/commands/prs' );
const repoCommand = require( '../lib/commands/repo' );
const testsCommand = require( '../lib/commands/tests' );

const csCallback = (args) => {
	console.log('cs stuff');
};

const configure = yargs => {
	// Global options.
	const globalCommand = yargs.version( '0.0.1' ).help();

	// "cs" command.
	yargs.command(
		'cs',
		'Coding standards commands',
		csCommand
	);

	yargs.command(
		'cli',
		'Meta CLI commands',
		command => {
		}
	);

	yargs.command(
		'completion',
		'Shell autocompletion',
		command => {
			command.showCompletionScript();
		}
	);

	yargs.command(
		'github',
		'GitHub connection commands',
		githubCommand
	);

	yargs.command(
		'issues',
		'Project issues',
		issuesCommand
	);

	yargs.command(
		'prs',
		'Project PRs',
		prsCommand
	);

	yargs.command(
		'repo',
		'Repository commands',
		repoCommand
	);

	yargs.command(
		'tests',
		'Unit tests commands',
		testsCommand
	);

	yargs.command(
		'vantage',
		'Vantage commands',
		require( '../lib/commands/vantage' )
	);

	// Require at least one subcommand.
	globalCommand.demandCommand( 1 );
	globalCommand.strict();

	return globalCommand;
};

const main = argv => {
	// Install handlers.
	loudRejection();

	// Check updates.
	updateNotifier({ pkg }).notify();

	// Configure parser.
	const parser = configure( yargs );

	// Run.
	parser.argv;
}

main( process.argv );
